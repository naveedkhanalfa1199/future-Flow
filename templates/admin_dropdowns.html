{% extends "base.html" %}
{% block title %}Manage Dropdowns{% endblock %}
{% block body %}

<div class="container">
    <div class="sidebar">
        <h2>Admin Menu</h2>
        <a href="{{ url_for('admin_dashboard') }}">Dashboard</a>
        <a href="{{ url_for('admin_universities') }}">Manage Universities</a>
        <a href="{{ url_for('admin_dropdowns') }}">Manage Dropdown Lists</a>
        <a href="{{ url_for('admin_staff') }}">Manage Staff</a>
        <a href="{{ url_for('admin_login_activity') }}">View Login Activity</a>
        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
    </div>

    <div class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <h2>Manage Dropdown Lists</h2>

        <div class="card">
            <div style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1; min-width: 200px;">
                    <label>Select Category</label>
                    <select id="categorySelect" onchange="window.location.href='{{ url_for('admin_dropdowns') }}?category=' + this.value" class="professional-select">
                        <option value="course_name" {% if category == 'course_name' %}selected{% endif %}>Course Name</option>
                        <option value="level" {% if category == 'level' %}selected{% endif %}>Level</option>
                    </select>
                </div>

                <button class="btn btn-primary" onclick="document.getElementById('addModal').style.display='block'">
                    Add New Item
                </button>
            </div>
        </div>

        {% if items %}
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Value</th>
                        <th>Parent</th>
                        <th>Display Order</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.value }}</td>
                        <td>{{ item.parent_value or '-' }}</td>
                        <td>{{ item.display_order }}</td>
                        <td>
                            <a href="{{ url_for('admin_delete_dropdown', id=item.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this item?')">
                                Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="card" style="text-align: center; padding: 40px;">
            <h3 style="color: #666;">No items found</h3>
            <p style="color: #999;">Add new items to this category using the "Add New Item" button.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add Modal -->
<div id="addModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; width:500px; margin:100px auto; padding:30px; border-radius:12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <h3>Add New {{ category.title() }}</h3>
        <form method="POST" action="{{ url_for('admin_add_dropdown') }}">
            <input type="hidden" name="category" value="{{ category }}">

            <div class="form-group">
                <label>Value</label>
                <input type="text" name="value" required>
            </div>

            {% if category in ['location', 'course_name'] %}
            <div class="form-group">
                <label>Parent</label>
                <select name="parent_value" class="professional-select">
                    <option value="">No Parent</option>
                    {% if category == 'location' %}
                        {% for country in countries %}
                        <option value="{{ country.value }}">{{ country.value }}</option>
                        {% endfor %}
                    {% elif category == 'course_name' %}
                        {% for level in levels %}
                        <option value="{{ level.value }}">{{ level.value }}</option>
                        {% endfor %}
                    {% endif %}
                </select>
                <small style="color: #666;">
                    {% if category == 'location' %}Select parent country{% endif %}
                    {% if category == 'course_name' %}Select course level{% endif %}
                </small>
            </div>
            {% endif %}

            <div class="form-group">
                <label>Display Order</label>
                <input type="number" name="display_order" value="0" min="0" required>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button type="submit" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('addModal').style.display='none'">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
// Close modal when clicking outside
document.getElementById('addModal').addEventListener('click', function(e) {
    if (e.target.id === 'addModal') {
        document.getElementById('addModal').style.display = 'none';
    }
});

// Page loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('âœ… Dropdowns page loaded successfully');
});
</script>

{% endblock %}